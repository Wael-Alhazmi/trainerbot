<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø§Ù„Ù…Ø¯Ø±Ø¨ Ø§Ù„Ø±Ù‚Ù…ÙŠ â€“ ØµÙˆØªÙŠ</title>

<style>
  body {
    font-family: "Tajawal", sans-serif;
    background: #F6F9F7;
    margin: 0; padding: 0;
  }

  .header {
    background: #0A7A42;
    color: white;
    padding: 18px;
    font-size: 24px;
    text-align: center;
  }

  #chat-box {
    width: 90%;
    margin: 20px auto;
    background: white;
    border-radius: 10px;
    padding: 15px;
    height: 430px;
    border: 2px solid #CFF5DD;
    overflow-y: auto;
  }

  .msg {
    margin: 12px 0;
    padding: 10px 14px;
    border-radius: 12px;
    max-width: 70%;
    line-height: 1.8;
  }

  .user-msg {
    background: #CFF5DD;
    margin-left: auto;
  }

  .bot-msg {
    background: #eee;
  }

  .controls {
    width: 90%;
    margin: auto;
    display: flex;
    gap: 10px;
  }

  input {
    flex: 1;
    padding: 12px;
    border: 1px solid #aaa;
    border-radius: 10px;
  }

  button {
    padding: 12px 20px;
    border-radius: 10px;
    background: #0A7A42;
    color: white;
    cursor: pointer;
    border: none;
  }

  #voiceBtn {
    background: #FFD000;
    font-size: 20px;
  }
</style>
</head>

<body>

<div class="header">Ø§Ù„Ù…Ø¯Ø±Ø¨ Ø§Ù„Ø±Ù‚Ù…ÙŠ â€“ Ù†Ø³Ø®Ø© ØµÙˆØªÙŠØ©</div>

<div id="chat-box">
  <div class="bot-msg msg">Ù…Ø±Ø­Ø¨Ø§Ù‹! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ­Ø¯Ø« Ø§Ù„Ø¢Ù† Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø§ÙŠÙƒ ðŸŽ¤</div>
</div>

<div class="controls">
  <button id="voiceBtn" onclick="startVoice()">ðŸŽ¤</button>
  <input id="userInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§">
  <button onclick="sendMessage()">Ø¥Ø±Ø³Ø§Ù„</button>
</div>

<script>
// ============= Ø§Ù„Ù…Ø§ÙŠÙƒ =============
let recognition;
let isListening = false;
let silenceTimer;

function startVoice() {
  // Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª
  if (isListening) { stopVoice(); return; }

  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SpeechRecognition) {
    alert("Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­.");
    return;
  }

  recognition = new SpeechRecognition();
  recognition.lang = "ar-SA";
  recognition.interimResults = true;
  recognition.continuous = true;

  isListening = true;
  document.getElementById("voiceBtn").style.background = "#e60000";

  let finalTranscript = "";

  recognition.onresult = (event) => {
    let interim = "";

    for (let i=0; i<event.results.length; i++) {
      if (event.results[i].isFinal) {
        finalTranscript += event.results[i][0].transcript;
      } else {
        interim += event.results[i][0].transcript;
      }
    }

    document.getElementById("userInput").value = finalTranscript + interim;

    resetSilenceTimer();
  };

  recognition.onerror = () => stopVoice();
  recognition.onend = () => stopVoice();

  recognition.start();
  resetSilenceTimer();
}

function resetSilenceTimer() {
  clearTimeout(silenceTimer);
  silenceTimer = setTimeout(() => {
    stopVoice();
    const msg = document.getElementById("userInput").value.trim();
    if (msg) sendMessage();
  }, 3000);
}

function stopVoice() {
  if (!isListening) return;
  isListening = false;
  try { recognition.stop(); } catch {}
  document.getElementById("voiceBtn").style.background = "#FFD000";
}

// =============== Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ================
async function sendMessage() {
  const input = document.getElementById("userInput");
  const msg = input.value.trim();
  if (!msg) return;

  addMessage(msg, "user");
  input.value = "";

  const botReply = "Ù‡Ø°Ø§ Ù…Ø«Ø§Ù„ Ù„Ø±Ø¯ Ù‚ØµÙŠØ± Ù…Ù† Ø§Ù„Ù…Ø¯Ø±Ø¨ Ø§Ù„Ø±Ù‚Ù…ÙŠ.";

  addMessage(botReply, "bot");
}

function addMessage(text, type) {
  const box = document.getElementById("chat-box");
  const div = document.createElement("div");
  div.className = type === "user" ? "msg user-msg" : "msg bot-msg";
  div.textContent = text;
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
}
</script>

</body>
</html>
